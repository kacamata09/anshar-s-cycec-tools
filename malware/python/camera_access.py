import socket
import cv2
import os
import time

def capture(file):
    cap = cv2.VideoCapture(0) 

    if not cap.isOpened():
        print("Kamera can't access.")
        exit()

    ret, frame = cap.read()

    time.sleep(3)
    
    if not ret:
        print("Failed capture.")
        exit()

    cv2.imwrite(file, frame)

    cap.release()

    print("Success capture")




def send_file(filename, host, port):
    try:
        client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        client_socket.connect((host, port))

        with open(filename, 'rb') as file:
            while True:
                data = file.read(1024)
                if not data:
                    break
                client_socket.send(data)

        client_socket.close()
        print(f"File {filename} success sent to {host}:{port}")

    except Exception as e:
        print(f"Error: {str(e)}")

if __name__ == "__main__":
    filename = "picture.jpg"

    capture(filename)

    host = '192.168.18.249'
    port = 9999

    send_file(filename, host, port)

    os.remove(filename)
