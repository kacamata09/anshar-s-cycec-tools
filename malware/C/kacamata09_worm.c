#include <stdio.h>
#include <Windows.h>

// cuma sebagai pengetahuan dan gambaran sedikit bagaimana worm bekerja
// worm yang sebenarnya dia menggandakan diri tanpa kita click, tapi ini cuma sebagai gambaran
// as knowledge how to worm work

int main() {
    char sourcePath[MAX_PATH];
    if(!GetModuleFileName(NULL, sourcePath, MAX_PATH)) {
        // perror("Error dapat filename");
        return 1;
    };

    FILE *sourceFile, *destFile;
    char buffer[1024];
    size_t bytesRead;
    
    // if folder C:, akan permission denied
    char destFolderPath[] = "D:\\Kacamata";
    // char destFolderPath[] = "D:\\";

    if (!CreateDirectory(destFolderPath, NULL) && GetLastError() != ERROR_ALREADY_EXISTS) {
        // perror("Error create folder");
        return 1;
    }

    char destPath[MAX_PATH];
    sprintf(destPath, "%s\\kacamata09.exe", destFolderPath);

    sourceFile = fopen(sourcePath, "rb");
    if (sourceFile == NULL) {
        perror("Error open sourcePath");
        return 1;
    }

    destFile = fopen(destPath, "wb");
    if (destFile == NULL) {
        perror("Error write destPath");
        fclose(sourceFile);
        return 1;
    }


    while ((bytesRead = fread(buffer, 1, sizeof(buffer), sourceFile)) > 0) {
        fwrite(buffer, 1, bytesRead, destFile);
    }

    fclose(sourceFile);
    fclose(destFile);

    // printf("Berhasil copy\n");

    return 0;
}
